# KamaitachiGo æµ‹è¯•æµç¨‹æ‰‹å†Œ

æœ¬æ–‡æ¡£æä¾›å®Œæ•´çš„3èŠ‚ç‚¹é›†ç¾¤æµ‹è¯•æµç¨‹ï¼ŒåŒ…æ‹¬å¯åŠ¨ã€éªŒè¯ã€å‹æµ‹ã€æ¸…ç†ç­‰æ‰€æœ‰æ­¥éª¤ã€‚

---

## ğŸ“‹ å‰ç½®å‡†å¤‡

### 1. ç¡®ä¿å·²ç¼–è¯‘æ‰€æœ‰å·¥å…·

```powershell
cd <path-to-repo>/KamaitachiGo

# æ„å»ºï¼ˆæ¨èï¼‰
# Windows ä¸Šå¯ç”Ÿæˆ .exeï¼Œä½†ä¸å¿…å°†äºŒè¿›åˆ¶æäº¤åˆ°ä»“åº“ï¼›ä¹Ÿå¯ä½¿ç”¨ `go run` ç›´æ¥è¿è¡Œæºç ã€‚
go build -o bin/master cmd/master/main.go
go build -o bin/slave cmd/slave/main.go
go build -o bin/gateway cmd/gateway/main.go
# å•ç‹¬æ„å»ºä¸¤ä¸ªå‹æµ‹å·¥å…·ï¼ˆæ¯ä¸ªæ–‡ä»¶åŒ…å«è‡ªå·±çš„ mainï¼‰
go build -o bin/benchmark tools/benchmark.go
go build -o bin/benchmark_scenarios tools/benchmark_scenarios.go

# æˆ–ç›´æ¥è¿è¡Œï¼ˆæ— éœ€æå‰æ„å»ºï¼‰
go run cmd/master/main.go
go run cmd/slave/main.go
go run cmd/gateway/main.go
go run tools/benchmark_scenarios.go -scenario 1 -requests 1500 -concurrent 30 -nodesAddr "http://localhost:8081,http://localhost:8082"
```

### 2. æ£€æŸ¥etcdæ˜¯å¦è¿è¡Œ

```powershell
# åœ¨æµè§ˆå™¨è®¿é—®
http://localhost:2379/version

# æˆ–ä½¿ç”¨PowerShellæ£€æŸ¥
curl http://localhost:2379/version
```

å¦‚æœetcdæœªè¿è¡Œï¼Œéœ€è¦å…ˆå¯åŠ¨etcdã€‚

---

## ğŸš€ æ­¥éª¤1ï¼šæ¸…ç†ç¯å¢ƒ

æ¯æ¬¡æµ‹è¯•å‰ï¼ŒåŠ¡å¿…å…ˆæ¸…ç†æ—§è¿›ç¨‹å’Œç¼“å­˜ï¼š

```powershell
# åœæ­¢æ‰€æœ‰èŠ‚ç‚¹è¿›ç¨‹
Get-Process | Where-Object {$_.Name -match "master|slave|server"} | Stop-Process -Force

# æ¸…ç†PowerShellåå°ä½œä¸šï¼ˆå¦‚æœæœ‰ï¼‰
Get-Job | Remove-Job -Force

# ç¡®è®¤æ²¡æœ‰æ®‹ç•™è¿›ç¨‹
Get-Process | Where-Object {$_.Name -match "master|slave"}
```

---

## ğŸ”§ æ­¥éª¤2ï¼šå¯åŠ¨3èŠ‚ç‚¹é›†ç¾¤

### æ–¹å¼Aï¼šä½¿ç”¨è„šæœ¬å¯åŠ¨ï¼ˆæ¨èï¼‰

```powershell
.\start_3nodes.ps1
```

è¯´æ˜ï¼šå¦‚æœéœ€è¦åŒæ—¶å¯åŠ¨ Gatewayï¼ˆç”¨äºå¯¹å¤–è´Ÿè½½å‡è¡¡ï¼‰ä»¥åŠ Master/Slave èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ `start_cluster.ps1`ã€‚è¯¥è„šæœ¬ä¼šæŒ‰é¡ºåºå¯åŠ¨ Masterã€ä¸¤ä¸ª Slave å’Œ Gatewayï¼Œå¹¶åœ¨å¯åŠ¨åæ£€æŸ¥å„æœåŠ¡çš„ `/health`ã€‚ç¤ºä¾‹ï¼š

```powershell
.\start_cluster.ps1
```

è¯¥è„šæœ¬ä½ç½®ï¼š[KamaitachiGo/start_cluster.ps1](KamaitachiGo/start_cluster.ps1)

### æ–¹å¼Bï¼šæ‰‹åŠ¨é€ä¸ªå¯åŠ¨

```powershell
# å¯åŠ¨MasterèŠ‚ç‚¹
Start-Job -Name "master" -ScriptBlock {
    Set-Location "<path-to-repo>/KamaitachiGo"
    .\bin\master -db "data/master.db" 2>&1 | Out-File -FilePath "logs/master.log" -Encoding UTF8
}

# ç­‰å¾…2ç§’
Start-Sleep -Seconds 2

# å¯åŠ¨Slave1èŠ‚ç‚¹
Start-Job -Name "slave1" -ScriptBlock {
    Set-Location "<path-to-repo>/KamaitachiGo"
    .\bin\slave -config "conf/slave1.ini" -db "data/slave1.db" 2>&1 | Out-File -FilePath "logs/slave1.log" -Encoding UTF8
}

# å¯åŠ¨Slave2èŠ‚ç‚¹
Start-Job -Name "slave2" -ScriptBlock {
    Set-Location "<path-to-repo>/KamaitachiGo"
    .\bin\slave -config "conf/slave2.ini" -db "data/slave2.db" 2>&1 | Out-File -FilePath "logs/slave2.log" -Encoding UTF8
}
```

---

## âœ… æ­¥éª¤3ï¼šéªŒè¯é›†ç¾¤çŠ¶æ€

### 3.1 ç­‰å¾…å¯åŠ¨å®Œæˆ

```powershell
# ç­‰å¾…10ç§’ï¼Œè®©èŠ‚ç‚¹å®Œå…¨å¯åŠ¨å¹¶æ³¨å†Œåˆ°etcd
Start-Sleep -Seconds 10
```

### 3.2 æ£€æŸ¥èŠ‚ç‚¹è¿›ç¨‹

```powershell
Get-Process | Where-Object {$_.Name -match "master|slave"}
```

åº”è¯¥çœ‹åˆ°3ä¸ªè¿›ç¨‹ï¼šmaster, slave (2ä¸ª)

### 3.3 éªŒè¯èŠ‚ç‚¹å¯è®¿é—®

```powershell
# æµ‹è¯•MasterèŠ‚ç‚¹
curl http://localhost:8080/health

# æµ‹è¯•Slave1èŠ‚ç‚¹
curl http://localhost:8081/health

# æµ‹è¯•Slave2èŠ‚ç‚¹
curl http://localhost:8082/health
```

æ‰€æœ‰èŠ‚ç‚¹éƒ½åº”è¯¥è¿”å›ï¼š`{"status":"ok"}`

### 3.4 æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡

```powershell
# MasterèŠ‚ç‚¹
curl http://localhost:8080/stats

# Slave1èŠ‚ç‚¹
curl http://localhost:8081/stats

# Slave2èŠ‚ç‚¹
curl http://localhost:8082/stats
```

åº”è¯¥çœ‹åˆ°ç¼“å­˜å‘½ä¸­ç‡ã€ç¼“å­˜å¤§å°ç­‰ä¿¡æ¯ã€‚

---

## ğŸ¯ æ­¥éª¤4ï¼šè¿è¡Œå‹åŠ›æµ‹è¯•

### 4.1 é€šç”¨æ€§èƒ½æµ‹è¯•ï¼ˆ10000è¯·æ±‚ï¼Œ150å¹¶å‘ï¼‰

```powershell
.\bin\benchmark -requests 10000 -concurrent 150 -nodes 3
```

æµ‹è¯•æ¨¡å¼è¯´æ˜ï¼š

1) å¸¦ Gateway çš„è´Ÿè½½å‡è¡¡æ¨¡å¼ï¼ˆæ¨èç”¨äºå¯¹å¤–å‹æµ‹ï¼‰

- åœºæ™¯ï¼šå¯¹å¤–å®¢æˆ·ç«¯é€šè¿‡ç»Ÿä¸€çš„ Gateway è®¿é—®ï¼ŒGateway å°†è¯·æ±‚è·¯ç”±åˆ°åç«¯èŠ‚ç‚¹å¹¶åšè´Ÿè½½å‡è¡¡ä¸é™æµã€ç†”æ–­ç­‰ç­–ç•¥ã€‚
- ä½¿ç”¨æ–¹å¼ï¼šå°†å‹æµ‹ç›®æ ‡æŒ‡å‘ Gatewayï¼Œå¦‚æœ API è¢« Gateway ä»£ç†åˆ° `/data` å‰ç¼€ï¼Œéœ€å¸¦ä¸Šè¯¥å‰ç¼€æˆ–åœ¨å‹æµ‹å·¥å…·ä¸­æŒ‡å®š `-pathPrefix`ã€‚

ç¤ºä¾‹ï¼šé€šè¿‡ Gatewayï¼ˆç›´æ¥åŒ…å«å‰ç¼€ï¼‰

```powershell
.\bin\benchmark_scenarios -scenario 1 -requests 1500 -concurrent 30 -nodesAddr "http://localhost:9000/data"
```

ç¤ºä¾‹ï¼šé€šè¿‡ Gateway æ ¹å¹¶ç”¨ `-pathPrefix`

```powershell
.\bin\benchmark_scenarios -scenario 1 -requests 1500 -concurrent 30 -nodesAddr "http://localhost:9000" -pathPrefix "/data"
```

ä½•æ—¶ç”¨ï¼šéœ€è¦éªŒè¯ Gateway çš„è·¯ç”±ã€é™æµã€ç†”æ–­å’ŒçœŸå®è´Ÿè½½å‡è¡¡æ•ˆæœæ—¶ï¼›ä¹Ÿæ˜¯å¯¹å¤–æ€§èƒ½çš„çœŸå®é¢„ä¼°ã€‚

2) ä¸å¸¦ Gateway çš„ç›´æ¥èŠ‚ç‚¹æµ‹è¯•ï¼ˆç”¨äºè°ƒè¯•ä¸èŠ‚ç‚¹çº§å¯¹æ¯”ï¼‰

- åœºæ™¯ï¼šç›´æ¥å¯¹åç«¯èŠ‚ç‚¹ï¼ˆSlave/Masterï¼‰å‘å‹ä»¥æ’æŸ¥å•ç‚¹æ€§èƒ½ã€æ¯”è¾ƒèŠ‚ç‚¹é—´å·®å¼‚æˆ–ç»•è¿‡ Gateway éªŒè¯èŠ‚ç‚¹è‡ªèº«è¡¨ç°ã€‚
- ä½¿ç”¨æ–¹å¼ï¼šå°† `-nodesAddr` è®¾ä¸ºé€—å·åˆ†éš”çš„èŠ‚ç‚¹åœ°å€åˆ—è¡¨ï¼ˆåŒ…å«ç«¯å£å’Œè·¯å¾„å‰ç¼€ï¼Œå¦‚éœ€è¦ï¼‰ã€‚

ç¤ºä¾‹ï¼šç›´æ¥å¯¹ä¸¤ä¸ª Slave èŠ‚ç‚¹å‹æµ‹ï¼ˆæ—  Gatewayï¼‰

```powershell
.\bin\benchmark_scenarios -scenario 1 -requests 1500 -concurrent 30 -nodesAddr "http://localhost:8081,http://localhost:8082"
```

ç¤ºä¾‹ï¼šé’ˆå¯¹å•ä¸ªèŠ‚ç‚¹è¿›è¡Œå‹æµ‹ï¼ˆè°ƒè¯•ç”¨ï¼‰

```powershell
.\bin\benchmark -requests 10000 -concurrent 50 -nodes 1 -nodesAddr "http://localhost:8081"
```

ä½•æ—¶ç”¨ï¼šéœ€è¦å®šä½èŠ‚ç‚¹é—®é¢˜ã€æ¯”è¾ƒç¼“å­˜/IO å¯¹èŠ‚ç‚¹æ€§èƒ½çš„å½±å“ï¼Œæˆ–åœ¨å¼€å‘ç¯å¢ƒå¿«é€ŸéªŒè¯æ¥å£å®ç°æ—¶ã€‚

æ³¨æ„ï¼šç›´æ¥å¯¹èŠ‚ç‚¹å‹æµ‹æ—¶ä¼šç»•è¿‡ Gateway çš„é™æµä¸ç†”æ–­ç­–ç•¥ï¼Œè§‚å¯Ÿåˆ°çš„ QPS/å»¶è¿Ÿä¸é€šè¿‡ Gateway çš„ç»“æœå¯èƒ½æ˜¾è‘—ä¸åŒã€‚

**é¢„æœŸç»“æœ**ï¼š
- QPS: 3000-3300
- P50å»¶è¿Ÿ: 30-50ms
- P99å»¶è¿Ÿ: 150-200ms
- æˆåŠŸç‡: 100%

### 4.2 ä½å¹¶å‘æµ‹è¯•ï¼ˆ1000è¯·æ±‚ï¼Œ10å¹¶å‘ï¼‰

```powershell
.\bin\benchmark -requests 1000 -concurrent 10 -nodes 3
```

**é¢„æœŸç»“æœ**ï¼š
- QPS: 800-1000
- P50å»¶è¿Ÿ: 10-15ms
- P99å»¶è¿Ÿ: 30-50ms

### 4.3 ä¸­å¹¶å‘æµ‹è¯•ï¼ˆ5000è¯·æ±‚ï¼Œ50å¹¶å‘ï¼‰

```powershell
.\bin\benchmark -requests 5000 -concurrent 50 -nodes 3
```

**é¢„æœŸç»“æœ**ï¼š
- QPS: 2000-2500
- P50å»¶è¿Ÿ: 20-30ms
- P99å»¶è¿Ÿ: 80-120ms

### 4.4 é«˜å¹¶å‘æµ‹è¯•ï¼ˆ15000è¯·æ±‚ï¼Œ200å¹¶å‘ï¼‰

```powershell
.\bin\benchmark -requests 15000 -concurrent 200 -nodes 3
```

**é¢„æœŸç»“æœ**ï¼š
- QPS: 2800-3200
- P50å»¶è¿Ÿ: 50-70ms
- P99å»¶è¿Ÿ: 200-300ms

---

## ğŸ† æ­¥éª¤5ï¼šè¿è¡Œåœºæ™¯æµ‹è¯•

### 5.1 åœºæ™¯1ï¼šå¤šå®ä½“åŒºé—´æ•°æ®ï¼ˆ1500è¯·æ±‚ï¼Œ30å¹¶å‘ï¼‰

```powershell
.\bin\benchmark_scenarios -scenario 1 -requests 1500 -concurrent 30 -nodes 3
```

**ç›®æ ‡QPS**: 300  
**é¢„æœŸQPS**: 2800-3000ï¼ˆè¶…æ ‡9-10å€ï¼‰

### 5.2 åœºæ™¯2ï¼šå•å®ä½“æœ€è¿‘æ•°æ®ï¼ˆ3000è¯·æ±‚ï¼Œ50å¹¶å‘ï¼‰

```powershell
.\bin\benchmark_scenarios -scenario 2 -requests 3000 -concurrent 50 -nodes 3
```

**ç›®æ ‡QPS**: 500  
**é¢„æœŸQPS**: 2000-2200ï¼ˆè¶…æ ‡4-4.5å€ï¼‰

### 5.3 åœºæ™¯3ï¼šå¤šå®ä½“æœ€æ–°+æ’åºï¼ˆ10000è¯·æ±‚ï¼Œ150å¹¶å‘ï¼‰

```powershell
.\bin\benchmark_scenarios -scenario 3 -requests 10000 -concurrent 150 -nodes 3
```

**ç›®æ ‡QPS**: 10000  
**é¢„æœŸQPS**: 2700-2900ï¼ˆå®Œæˆ27-29%ï¼‰

### 5.4 åœºæ™¯4ï¼šå¤šå®ä½“æŒ‡å®šæ—¥æœŸï¼ˆ3000è¯·æ±‚ï¼Œ50å¹¶å‘ï¼‰

```powershell
.\bin\benchmark_scenarios -scenario 4 -requests 3000 -concurrent 50 -nodes 3
```

**ç›®æ ‡QPS**: 300  
**é¢„æœŸQPS**: 3300-3500ï¼ˆè¶…æ ‡11-12å€ï¼‰

### 5.5 è¿è¡Œæ‰€æœ‰åœºæ™¯ï¼ˆä¸€é”®æµ‹è¯•ï¼‰

```powershell
Write-Host "`n========== Scenario 1 ==========" -ForegroundColor Cyan
.\bin\benchmark_scenarios -scenario 1 -requests 1500 -concurrent 30 -nodes 3 | Select-String "QPS|Target"

Write-Host "`n========== Scenario 2 ==========" -ForegroundColor Cyan
.\bin\benchmark_scenarios -scenario 2 -requests 3000 -concurrent 50 -nodes 3 | Select-String "QPS|Target"

Write-Host "`n========== Scenario 3 ==========" -ForegroundColor Cyan
.\bin\benchmark_scenarios -scenario 3 -requests 10000 -concurrent 150 -nodes 3 | Select-String "QPS|Target"

Write-Host "`n========== Scenario 4 ==========" -ForegroundColor Cyan
.\bin\benchmark_scenarios -scenario 4 -requests 3000 -concurrent 50 -nodes 3 | Select-String "QPS|Target"
```

---

## ğŸ“Š æ­¥éª¤6ï¼šæŸ¥çœ‹æ€§èƒ½ç»Ÿè®¡

### 6.1 æŸ¥çœ‹ç¼“å­˜å‘½ä¸­ç‡

```powershell
# MasterèŠ‚ç‚¹
$stats = curl http://localhost:8080/stats | ConvertFrom-Json
Write-Host "Master - Hit Rate: $($stats.cache_hit_rate)"

# Slave1èŠ‚ç‚¹
$stats = curl http://localhost:8081/stats | ConvertFrom-Json
Write-Host "Slave1 - Hit Rate: $($stats.cache_hit_rate)"

# Slave2èŠ‚ç‚¹
$stats = curl http://localhost:8082/stats | ConvertFrom-Json
Write-Host "Slave2 - Hit Rate: $($stats.cache_hit_rate)"
```

**é¢„æœŸå‘½ä¸­ç‡**: 99%ä»¥ä¸Š

### 6.2 æŸ¥çœ‹è´Ÿè½½å‡è¡¡æƒ…å†µ

```powershell
# æŸ¥çœ‹å„èŠ‚ç‚¹çš„è¯·æ±‚æ•°
curl http://localhost:8080/stats | ConvertFrom-Json | Select-Object total_requests
curl http://localhost:8081/stats | ConvertFrom-Json | Select-Object total_requests
curl http://localhost:8082/stats | ConvertFrom-Json | Select-Object total_requests
```

---

## ğŸ”„ æ­¥éª¤7ï¼šæµ‹è¯•ç¼“å­˜é¢„çƒ­æ•ˆæœ

### 7.1 å†·å¯åŠ¨æµ‹è¯•

```powershell
# 1. æ¸…ç†ç¯å¢ƒ
Get-Process | Where-Object {$_.Name -match "master|slave"} | Stop-Process -Force

# 2. åˆ é™¤æ•°æ®æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œç”¨äºæµ‹è¯•å®Œå…¨å†·å¯åŠ¨ï¼‰
# Remove-Item data\*.db -Force

# 3. é‡æ–°å¯åŠ¨é›†ç¾¤
.\start_3nodes.ps1

# 4. ç­‰å¾…ç¼“å­˜é¢„çƒ­ï¼ˆçº¦10ç§’ï¼‰
Start-Sleep -Seconds 10

# 5. ç«‹å³æµ‹è¯•ï¼ˆç¼“å­˜é¢„çƒ­åï¼‰
.\bin\benchmark -requests 1000 -concurrent 10 -nodes 3
```

### 7.2 çƒ­å¯åŠ¨æµ‹è¯•

```powershell
# åœ¨å·²è¿è¡Œçš„é›†ç¾¤ä¸Šç›´æ¥æµ‹è¯•
.\bin\benchmark -requests 5000 -concurrent 50 -nodes 3
```

çƒ­å¯åŠ¨åº”è¯¥æ¯”å†·å¯åŠ¨æœ‰æ›´å¥½çš„P50å»¶è¿Ÿï¼ˆå› ä¸ºç¼“å­˜å·²ç»é¢„çƒ­ï¼‰ã€‚

---

## ğŸ› ï¸ æ­¥éª¤8ï¼šåŠŸèƒ½æµ‹è¯•

### 8.1 æµ‹è¯•å•ä¸ªAPI

```powershell
# æµ‹è¯•å¿«ç…§æ•°æ®APIï¼ˆåœºæ™¯2ï¼‰
$body = @{
    subject_keys = @("33:00000009")
    indicator_codes = @("1001")
    report_types = @("0408")
    periods = @("20231231", "20230930")
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://localhost:8080/api/v1/snapshot/recent" -Method Post -Body $body -ContentType "application/json"
```

### 8.2 æµ‹è¯•é™æµ

```powershell
# å¿«é€Ÿå‘é€å¤šä¸ªè¯·æ±‚ï¼Œè§¦å‘é™æµï¼ˆé»˜è®¤100 QPSï¼‰
1..150 | ForEach-Object {
    Start-Job -ScriptBlock {
        curl http://localhost:8080/health
    }
}

# ç­‰å¾…å®Œæˆ
Get-Job | Wait-Job

# æŸ¥çœ‹ç»“æœï¼ˆåº”è¯¥æœ‰éƒ¨åˆ†è¯·æ±‚è¢«é™æµï¼‰
Get-Job | Receive-Job

# æ¸…ç†ä½œä¸š
Get-Job | Remove-Job
```

### 8.3 æµ‹è¯•ç†”æ–­

```powershell
# æ‰‹åŠ¨è§¦å‘å¤§é‡è¯·æ±‚æŸ¥çœ‹ç†”æ–­å™¨çŠ¶æ€
curl http://localhost:8080/metrics/circuit_breaker
```

---

## ğŸ§¹ æ­¥éª¤9ï¼šæ¸…ç†å’Œå…³é—­

### 9.1 ä¼˜é›…å…³é—­é›†ç¾¤

```powershell
# åœæ­¢æ‰€æœ‰èŠ‚ç‚¹
Get-Process | Where-Object {$_.Name -match "master|slave"} | Stop-Process -Force

# ç¡®è®¤è¿›ç¨‹å·²åœæ­¢
Get-Process | Where-Object {$_.Name -match "master|slave"}
```

### 9.2 æ¸…ç†æ—¥å¿—ï¼ˆå¯é€‰ï¼‰

```powershell
# æ¸…ç†æ—¥å¿—æ–‡ä»¶
Remove-Item logs\*.log -Force
```

### 9.3 é‡ç½®æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰

```powershell
# å¦‚æœéœ€è¦å®Œå…¨é‡æ–°å¼€å§‹ï¼Œåˆ é™¤æ•°æ®åº“æ–‡ä»¶
Remove-Item data\*.db -Force
```

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šèŠ‚ç‚¹å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼šè¿è¡Œæµ‹è¯•æ—¶æç¤ºè¿æ¥å¤±è´¥

**æ’æŸ¥æ­¥éª¤**ï¼š
```powershell
# 1. æ£€æŸ¥è¿›ç¨‹æ˜¯å¦åœ¨è¿è¡Œ
Get-Process | Where-Object {$_.Name -match "master|slave"}

# 2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -ano | findstr "8080"
netstat -ano | findstr "8081"
netstat -ano | findstr "8082"

# 3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
Get-Content logs\master.log -Tail 20
Get-Content logs\slave1.log -Tail 20
Get-Content logs\slave2.log -Tail 20
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¦‚æœç«¯å£è¢«å ç”¨ï¼Œåœæ­¢å ç”¨è¿›ç¨‹æˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶ç«¯å£
- å¦‚æœæ—¥å¿—æ˜¾ç¤ºé”™è¯¯ï¼Œæ ¹æ®é”™è¯¯ä¿¡æ¯æ’æŸ¥

### é—®é¢˜2ï¼šetcdè¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šèŠ‚ç‚¹æ—¥å¿—æ˜¾ç¤ºæ— æ³•è¿æ¥åˆ°etcd

**æ’æŸ¥æ­¥éª¤**ï¼š
```powershell
# æ£€æŸ¥etcdæ˜¯å¦è¿è¡Œ
curl http://localhost:2379/version
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¯åŠ¨etcdæœåŠ¡
- æ£€æŸ¥conf/master.iniå’Œconf/slave*.iniä¸­çš„etcdåœ°å€é…ç½®

### é—®é¢˜3ï¼šæ€§èƒ½å¼‚å¸¸ä½

**ç—‡çŠ¶**ï¼šQPSè¿œä½äºé¢„æœŸï¼ˆ<1000ï¼‰

**æ’æŸ¥æ­¥éª¤**ï¼š
```powershell
# 1. æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ªèŠ‚ç‚¹å®ä¾‹åœ¨è¿è¡Œ
Get-Process | Where-Object {$_.Name -match "master|slave"} | Measure-Object

# 2. æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
curl http://localhost:8080/stats
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ¸…ç†æ‰€æœ‰æ—§è¿›ç¨‹åé‡æ–°å¯åŠ¨
- ç¡®ä¿ç¼“å­˜é¢„çƒ­å®Œæˆï¼ˆç­‰å¾…10ç§’ï¼‰
- é‡æ–°ç¼–è¯‘å‹æµ‹å·¥å…·

### é—®é¢˜4ï¼šå‹æµ‹å¡ä½

**ç—‡çŠ¶**ï¼šå‹æµ‹å·¥å…·è¿è¡Œä¸­é€”å¡ä½ä¸åŠ¨

**å¯èƒ½åŸå› **ï¼š
- å¹¶å‘è¿‡é«˜ï¼ŒèŠ‚ç‚¹å¤„ç†ä¸è¿‡æ¥
- æ•°æ®åº“æ–‡ä»¶é”ç«äº‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
```powershell
# 1. é™ä½å¹¶å‘æ•°
.\bin\benchmark -requests 5000 -concurrent 50 -nodes 3

# 2. å¦‚æœè¿˜æ˜¯å¡ä½ï¼Œé‡å¯é›†ç¾¤
Get-Process | Where-Object {$_.Name -match "master|slave"} | Stop-Process -Force
.\start_3nodes.ps1
Start-Sleep -Seconds 10
```

### é—®é¢˜5ï¼šç¼“å­˜å‘½ä¸­ç‡ä½

**ç—‡çŠ¶**ï¼šç¼“å­˜å‘½ä¸­ç‡ < 90%

**æ’æŸ¥æ­¥éª¤**ï¼š
```powershell
# æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
curl http://localhost:8080/stats | ConvertFrom-Json
```

**å¯èƒ½åŸå› **ï¼š
- æµ‹è¯•çš„subject_keyåœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨
- ç¼“å­˜å¤§å°ä¸è¶³
- ç¼“å­˜é¢„çƒ­æœªå®Œæˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç­‰å¾…ç¼“å­˜é¢„çƒ­å®Œæˆ
- è¿è¡Œå¤šæ¬¡æµ‹è¯•ï¼Œåç»­æµ‹è¯•å‘½ä¸­ç‡ä¼šæé«˜

---

## ğŸ“ˆ æ€§èƒ½åŸºå‡†å‚è€ƒ

### 3èŠ‚ç‚¹é…ç½®

| æµ‹è¯•åœºæ™¯ | è¯·æ±‚æ•° | å¹¶å‘æ•° | QPSèŒƒå›´ | P50å»¶è¿Ÿ | P99å»¶è¿Ÿ |
|---------|--------|--------|---------|---------|---------|
| ä½å¹¶å‘ | 1000 | 10 | 800-1000 | 10-15ms | 30-50ms |
| ä¸­å¹¶å‘ | 5000 | 50 | 2000-2500 | 20-30ms | 80-120ms |
| é«˜å¹¶å‘ | 10000 | 150 | 3000-3300 | 30-50ms | 150-200ms |
| æé™ | 15000 | 200 | 2800-3200 | 50-70ms | 200-300ms |

### åœºæ™¯

| åœºæ™¯ | ç›®æ ‡QPS | å®é™…QPS | å®Œæˆåº¦ |
|------|---------|---------|--------|
| åœºæ™¯1 | 300 | 2800-3000 | 930-1000% |
| åœºæ™¯2 | 500 | 2000-2200 | 400-440% |
| åœºæ™¯3 | 10000 | 2700-2900 | 27-29% |
| åœºæ™¯4 | 300 | 3300-3500 | 1100-1167% |

---

## ğŸ’¡ æµ‹è¯•æŠ€å·§

### 1. å¿«é€ŸéªŒè¯

```powershell
# ä¸€é”®éªŒè¯é›†ç¾¤æ˜¯å¦æ­£å¸¸
curl http://localhost:8080/health; curl http://localhost:8081/health; curl http://localhost:8082/health
```

### 2. è¿ç»­æµ‹è¯•

```powershell
# è¿ç»­è¿è¡Œ3æ¬¡æµ‹è¯•ï¼Œè§‚å¯Ÿæ€§èƒ½ç¨³å®šæ€§
1..3 | ForEach-Object {
    Write-Host "`n========== Round $_ ==========" -ForegroundColor Green
    .\bin\benchmark -requests 5000 -concurrent 50 -nodes 3 | Select-String "QPS|P50|P99"
    Start-Sleep -Seconds 5
}
```

### 3. æ€§èƒ½å¯¹æ¯”æµ‹è¯•

```powershell
# æµ‹è¯•ä¸åŒèŠ‚ç‚¹æ•°çš„æ€§èƒ½
Write-Host "`n========== 1 Node ==========" -ForegroundColor Cyan
.\bin\benchmark -requests 5000 -concurrent 50 -nodes 1 | Select-String "QPS"

Write-Host "`n========== 2 Nodes ==========" -ForegroundColor Cyan
.\bin\benchmark -requests 5000 -concurrent 50 -nodes 2 | Select-String "QPS"

Write-Host "`n========== 3 Nodes ==========" -ForegroundColor Cyan
.\bin\benchmark -requests 5000 -concurrent 50 -nodes 3 | Select-String "QPS"
```

### 4. ä¿å­˜æµ‹è¯•ç»“æœ

```powershell
# å°†æµ‹è¯•ç»“æœä¿å­˜åˆ°æ–‡ä»¶
$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
.\bin\benchmark -requests 10000 -concurrent 150 -nodes 3 | Tee-Object -FilePath "test_results_$timestamp.txt"
```

---

## ğŸ“ æµ‹è¯•è®°å½•æ¨¡æ¿

å»ºè®®æ¯æ¬¡é‡è¦æµ‹è¯•åè®°å½•ç»“æœï¼š

```
æµ‹è¯•æ—¶é—´: 2025-10-24 16:00:00
æµ‹è¯•åœºæ™¯: é«˜å¹¶å‘é€šç”¨æµ‹è¯•
é…ç½®: 3èŠ‚ç‚¹ï¼ˆ1 Master + 2 Slavesï¼‰
å‚æ•°: 10000è¯·æ±‚, 150å¹¶å‘

ç»“æœ:
- QPS: 3240.81
- P50å»¶è¿Ÿ: 37ms
- P99å»¶è¿Ÿ: 182ms
- æˆåŠŸç‡: 100%
- ç¼“å­˜å‘½ä¸­ç‡: 99.6%

å¤‡æ³¨: æ€§èƒ½ç¨³å®šï¼Œç¬¦åˆé¢„æœŸ
```

---

## ğŸ¯ æµ‹è¯•æ£€æŸ¥æ¸…å•

æµ‹è¯•å‰ï¼š
- [ ] etcdå·²å¯åŠ¨
- [ ] å·²æ¸…ç†æ—§è¿›ç¨‹
- [ ] å·²ç¼–è¯‘æœ€æ–°ä»£ç 
- [ ] æ•°æ®åº“æ–‡ä»¶å°±ç»ª

æµ‹è¯•ä¸­ï¼š
- [ ] èŠ‚ç‚¹å…¨éƒ¨å¯åŠ¨æˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] ç¼“å­˜é¢„çƒ­å®Œæˆï¼ˆç­‰å¾…10ç§’ï¼‰
- [ ] å‹æµ‹å·¥å…·æ­£å¸¸è¿è¡Œ

æµ‹è¯•åï¼š
- [ ] è®°å½•æµ‹è¯•ç»“æœ
- [ ] æŸ¥çœ‹ç¼“å­˜ç»Ÿè®¡
- [ ] æ¸…ç†è¿›ç¨‹å’Œä½œä¸š
- [ ] ä¿å­˜æ—¥å¿—ï¼ˆå¦‚éœ€è¦ï¼‰

---

**æœ€åæ›´æ–°**: 2025-10-24  
**ç‰ˆæœ¬**: v1.0

